window.BroadPhase={};!function(i){function t(){}t.prototype.check=function(i,t,s){var r=i.length,e=[];if(r<2)return;for(var h=0;h<r;h++){var o=i[h];for(var n=h+1;n<r;n++){var a=i[n];if(t(o,a)){if(s)s(o,a);e.push([o,a])}}}return e};i.BruteForce=t}(window.BroadPhase);!function(i,t){function s(i,s,r,e){this.width=i;this.height=s;this.cellWidth=r||this.width/10;this.cellHeight=e||this.height/10;this.rows=Math.ceil(this.height/this.cellHeight);this.cols=Math.ceil(this.width/this.cellWidth);this.bruteForce=new t;this.grid=[]}s.prototype.resetGrid=function(){for(var i=0;i<this.rows;i++){if(!this.grid[i])continue;this.grid[i].length=0}};s.prototype.check=function(i,t,s){var r=i.length,e=[];this.resetGrid();for(var h=0;h<r;h++){var o=i[h];var n=(o.x-o.radius)/this.cellWidth<<0;var a=(o.x+o.radius)/this.cellWidth<<0;var d=(o.y-o.radius)/this.cellHeight<<0;var c=(o.y+o.radius)/this.cellHeight<<0;for(var u=d;u<=c;u++){var l=this.grid[u];if(!l)l=this.grid[u]=[];for(var f=n;f<=a;f++){var p=l[f];if(!p)p=this.grid[u][f]=[];p.push(o)}}}for(var u=0;u<this.rows;u++){var l=this.grid[u];if(!l)continue;for(var f=0;f<this.cols;f++){var p=l[f];if(!p)continue;e.concat(this.bruteForce.check(p,t,s))}}return e};i.HashGrid=s}(window.BroadPhase,window.BroadPhase.BruteForce);!function(i,t){function s(i,t,s){this.bounds=i;this.maxDepth=t;this.maxParticles=s;this.particles=[];this.nodes=[]}s.TOP_LEFT=0;s.TOP_RIGHT=1;s.BOTTOM_LEFT=2;s.BOTTOM_RIGHT=3;s.prototype.bruteForce=new i.BruteForce;s.prototype.clear=function(){this.particles.length=0;for(var i=0;i<this.nodes.length;i++){this.nodes[i].clear()}this.nodes.length=0};s.prototype.subDivide=function(){var i=this.bounds.width/2,t=this.bounds.height/2,r=this.bounds.x,e=this.bounds.y,h=this.maxDepth-1,o=this.maxParticles;function n(r,e){return new s({x:r,y:e,width:i,height:t},h,o)}this.nodes[s.TOP_LEFT]=n(r,e);this.nodes[s.TOP_RIGHT]=n(r+i,e);this.nodes[s.BOTTOM_LEFT]=n(r,e+t);this.nodes[s.BOTTOM_RIGHT]=n(r+i,e+t)};s.prototype.findQuadrant=function(i){var t=this.bounds.x+this.bounds.width/2,r=this.bounds.y+this.bounds.height/2;var e=i.x+i.radius<t,h=i.x-i.radius>t,o=i.y+i.radius<r,n=i.y-i.radius>r;if(o&&e)return this.nodes[s.TOP_LEFT];if(o&&h)return this.nodes[s.TOP_RIGHT];if(n&&e)return this.nodes[s.BOTTOM_LEFT];if(n&&h)return this.nodes[s.BOTTOM_RIGHT]};s.prototype.isLeaf=function(){return this.nodes.length==0};s.prototype.insert=function(i){if(!this.isLeaf()){var t=this.findQuadrant(i);if(t){t.insert(i);return}}this.particles.push(i);if(this.particles.length>this.maxParticles&&this.maxDepth>0){if(this.isLeaf()){this.subDivide()}var s=0;while(s<this.particles.length){var t=this.findQuadrant(this.particles[s]);if(t){t.insert(this.particles.splice(s,1)[0])}else{s++}}}};s.prototype.queryPossibleCollisions=function(i){var t=this.particles;if(!this.isLeaf()){var s=this.findQuadrant(i);if(s){t=t.concat(s.queryPossibleCollisions(i))}}return t};s.prototype.check=function(i,t,s){this.clear();var r=i.length,e=[],h;for(h=0;h<r;h++){this.insert(i[h])}for(h=0;h<r;h++){var o=this.queryPossibleCollisions(i[h]);e.concat(this.bruteForce.check(o,t,s))}};i.QuadTree=s}(window.BroadPhase,window.BroadPhase.BruteForce);